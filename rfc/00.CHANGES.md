## Changes

This document describes the main problems identified in the current Pipes SDK API and the proposed directions to address them.

---

### 1. Transformer type extraction in TypeScript

**Problem**

Extracting the output type of a transformer chain is currently cumbersome and fragile.

Example of the current pattern:

```ts
transform1(transform2(transform3(source())))
```

This approach is:
- hard to read
- hard to maintain
- difficult to type correctly 

**Proposed solution**

Export type helpers (for example, `ResultOf<T>`) that can extract the resulting type directly from a transformer or pipeline, without relying on nested calls.

See a more complex example here:  
[Example](../docs/examples/evm/11.simple.decoder.ts)

---

### 2. Accidental reuse of pipe IDs in targets

**Problem**

It is easy to accidentally run different pipelines with the same target ID, which can lead to data being overwritten or mixed.

**Proposed solution**

- Require a target ID at target creation time.
- Pass this ID into the pipeline context.
- Expose it as `ctx.target.id` for all downstream consumers.

Example:

```ts
await evmPortalSource({ ... }).pipeTo(
  clickhouseTarget({
    id: 'erc-20',
    client,
    settings: {
      // optional object to specify target table per stream
      state: {
        table: 'sync',
        database: 'default',
      },
    },
    onRollback: async () => {},
    onData: async ({ data, ctx }) => {
      // also available as ctx.target.id
      ctx.target.id = 'erc-20'
    },
  }),
)
```

---

### 3. Query‑aware transformers redesign

**Problem**

The current design of query‑aware transformers is hard to reason about and tightly coupled to pipeline ordering.

**Proposed solution**

Redesign this mechanism as described in the separate proposal:

[Streams & query model proposal](./01.STREAMS.md)

---

### 4. Naming confusion: `.pipe` vs `.transform`

**Problem**

The distinction between `.pipe` and `.transform` is not intuitive and frequently causes confusion.

**Proposed solution**

Address this as part of the same redesign described in:

[Streams & query model proposal](./01.STREAMS.md)
